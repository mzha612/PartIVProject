Michael Zhang 9-06-18

Based on v3,

Purpose to clean up, rename variables, and most importantly allow the rat messentry data to work.